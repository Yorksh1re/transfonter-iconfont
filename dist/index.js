#!/usr/bin/env node
"use strict";var t=require("axios"),o=require("fs-extra");function a(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=a(t),r=a(o);async function n(t){const o=await async function(t){try{return t=c(t),(await e.default(t)).data}catch(t){console.log("❌ 错误！请检查url是否正确"),process.exit(1)}}(t),a=/url\(\'(.*)\'\) format\(\'woff2\'\)/,r=o.match(a)[1];return o.replace(a,await async function(t){t=c(t);const o=(await e.default(t,{responseType:"arraybuffer"})).data;return`url('data:application/x-font-woff2;charset=utf-8;base64,${Buffer.from(o).toString("base64")}') format('woff2')`}(r))}function c(t){return t.replace(/(^\/\/)(.*)/,"http:$1$2").replace(/(^at.alicdn.com)(.*)/,"http://$1$2")}const s=require("commander"),i=require("path");s.version("0.1.0","-v --version").description("生成base64的iconfont到本地").option("-s, --src [src]","iconfont css url").option("-o, --output [path]","生成的文件路径").action((async function({src:t,output:o}){let a;if(!t||!o)try{a=JSON.parse(r.default.readFileSync("package.json","utf8")).iconfont}catch(t){console.log("请指定package.json 的 iconfont，详见文档。"),process.exit(1)}t||(t=a.src);const e=await n(t);o||(o=a.output),r.default.outputFile(i.resolve(".",o),e,{flag:"w+",encoding:"utf8"}),console.log("✅ 生成完成")})).parse(process.argv);
